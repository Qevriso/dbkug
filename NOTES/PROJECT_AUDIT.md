# PROJECT_AUDIT (dbkug)

Дата: 2025-12-29

## Критичные/заметные проблемы

1) Dynamic include + Alpine
- Шаблоны в `tpl/*.html` грузятся через `data-include` (см. `index.html` + `include.js`).
- В `tpl/header.html` используется Alpine (`x-data`, `x-show`, `x-transition`).
- Если Alpine стартует раньше, чем подгрузятся include-блоки, Alpine не инициализирует динамически вставленную разметку → мобильное меню/кнопки могут не работать.
- Исправлено в `include.js`: include-загрузка стартует сразу (а не только по DOMContentLoaded) + добавлена `Alpine.initTree(el)` для вставленных узлов, если Alpine уже запущен.

2) Битая ссылка на страницу услуги
- В `tpl/services1.html` кнопка «Подробнее» ведёт на `/services/services1.html`.
- В репозитории нет папки/страницы `services/services1.html` (есть только `tpl/services1.html`).
- Нужно решить: либо добавить реальные страницы `/services/*.html`, либо заменить ссылки на якоря/попап/секцию.

## Формы и JS

- В проекте 2 разных маски телефона:
  - `assets/js/forms.js` работает по селектору `input[data-phone]` (используется в `tpl/calc-cost.html`).
  - В `index.html` в большом попапе есть отдельная маска по `#phoneInput`.
  - Это не ломает работу напрямую, но может привести к разнобою поведения/валидации. Рекомендация: унифицировать на один механизм (например, перейти на `data-phone` везде).

- Большой попап (в `index.html`) содержит чекбокс согласия без `name`, поэтому факт согласия не уходит на сервер. Если нужно логировать/проверять — добавьте `name="consent" value="1"`.

## PHP send-form.php

- Эндпойнт отдаёт JSON, но раньше не выставлял `Content-Type: application/json`.
- Использовал `$_SERVER['HTTP_HOST']` как часть `From:` без санитизации (в редких конфигурациях может быть проблемой).
- Исправлено в `send-form.php`: добавлен JSON Content-Type, санитизация host, `exit` после ответа.

Риски, которые пока не решались (требуют отдельного решения):
- Нет антиспама/рейта (капча/хонипот/limit по IP) → возможен спам на почту.
- Нет строгой валидации полей (длина, формат телефона и т.п.).

## Общие замечания

- `data-include` работает только при запуске через HTTP(S). Если открыть `index.html` как `file://`, fetch будет блокироваться политиками браузера.
- В хедере/футере много ссылок `href="#"` — это нормально как заглушки, но если это прод, лучше заменить на реальные якоря/страницы.

## Следующие шаги (по согласованию)

1) Определиться с маршрутизацией «Подробнее» для услуг (создаём страницы или меняем ссылки на секции/попап).
2) Унифицировать телефонную маску и серверную валидацию.
3) Добавить простой антиспам в `send-form.php` (хонипот + минимум задержка + лимиты).
